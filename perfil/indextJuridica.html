<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqk1w27APbCmnBmcLm/iUWLdk6DYuY/vYf2oQS45K/aQGwfqP/Bm4U+kM+N/4PAknZkd2w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./assets/css/stylePerfilJ.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/3da44e21a2.js" crossorigin="anonymous"></script>
    <script src="js/progressbar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/parallax.js/1.4.2/parallax.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>

    <!-- Estilos do card inspirado no seu código de login -->
    <style>
        
    </style>

</head>
<body onload="load()">

  <div class="container">
    <div class="row flex-lg-nowrap">
      
    
      <div class="col">
        <div class="row">
          <div class="col mb-3">
            <div class="card"> 
              <div class="card-body">
                <div id="userBanner"><i class="bi bi-images"></i></div>
                <input type="file" accept="image/*" id="uploadBanner" style="display: none;">
                <div class="e-profile">
                  <div class="row" id="userData">


                    <div class="col-12 col-sm-auto mb-3">





                      <div class="mx-auto" style="width: 140px;">
                        <div class="d-flex justify-content-center align-items-center rounded" style="height: 140px; ">
                          
                          <div class="border rounded-circle" id="profilePic"></div>
                          
                        </div>
                      </div>
                    </div>

                    <button id="imageSelector" class="btn btn-primary" type="button">
                      <i class="fa fa-fw fa-camera"></i>

                      <span><label type="button" class="" id="ver-mais">Alterar Foto</label></span>
                      
                      <input id="inputImage" type="file" accept="image/jpeg, image/jpg, image/png">
                      <!-- <img src="img/profile.jpg" alt="Perfume 1" class="card-img-top" id="profilePic">
                      <label type="button" class="btn btn-danger position-absolute w-100 rounded-0" id="ver-mais">MODIFICAR IMAGEM</label>
                      <input id="inputImage" type="file" accept="image/jpeg, image/jpg, image/png"> -->
                    </button>
                   
                   
                   
                    <div class="col d-flex flex-column flex-sm-row justify-content-between mb-3" id="userInfo">
                      <div class="text-center text-sm-left mb-2 mb-sm-0">
                        <h4 class="pt-sm-2 pb-1 mb-0 text-nowrap" id="profileName">Nome</h4>
                        <p class="mb-0" id="profileUser">@Usuário</p>
                        <!-- <div class="text-muted"><small>Visto pela última vez há 1 minuto</small></div> -->
                        <div class="mt-2">

                        </div>
                      </div>
                      <div class="text-center text-sm-right">
                        <span class="badge badge-secondary">Empresa</span>
                        <div class="text-muted"><small id="quandoEntrou"><!--Entrou em 15 de Maio 2024--></small></div>
                      </div>
                    </div>


                  </div>
                  <ul class="nav nav-tabs">
                    <li class="nav-item"><a href="#" class="active nav-link" id="configuracoes-tab">Configurações</a></li>
                    <li class="nav-item"><a href="#" class="active nav-link" id="configuracoes-adicionais-tab">Configurações Adicionais</a></li>
                  </ul>


                  <!-- começo do conteudo conteudo "configuraçoes" -->

                  <div id="configuracoes-content" class="tab-content pt-3">
                    <div class="tab-pane active">
                      <form class="form" novalidate="">
                        <div class="row">
                          <div class="col">
                            <div class="row">
                              <div class="col">
                                <div class="form-group">
                                  <label>Nome da Empresa</label>
                                  <input id="newName" class="form-control" type="text" name="name" placeholder="Nome da Empresa" value="">
                                </div>
                              </div>
                              <div class="col">
                                <div class="form-group">
                                  <label>Id da Empresa</label>
                                  <input id="newUser" class="form-control" type="text" name="username" placeholder="Id" value="">
                                </div>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col">
                                <div class="form-group">
                                  <label>E-mail Comercial</label>
                                  <input id="newEmail" class="form-control" type="text" placeholder="email@gmail.com">
                                </div>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col mb-3">
                                <div class="form-group">
                                  <label>Sobre</label>
                                  <textarea id="newDescription" class="form-control" rows="5" placeholder="Sobre a Empresa"></textarea>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                  
                        <div class="row">
                          <div class="col d-flex justify-content-end">
                            <button id="saveProfileBtn" class="btn btn-primary" type="button">Salvar Alterações</button>
                          </div>
                        </div>
                      </form>
    
                    </div>
                  </div>

                       <!-- fim do conteudo "configuraçoes" -->

                      <!-- começo do conteudo "configuraçoes adicionais" -->

                      <div id="configuracoes-adicionais-content" class="tab-content pt-3">
                        <div class="tab-pane active" id="basico">
                            <form class="form" novalidate="">
                                <div class="row">
                                    <div class="col">
                                        <div class="row">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>Nome da Empresa</label>
                                                    <input disabled id="newName2" class="form-control" type="text" name="name" placeholder="Nome da Empresa" value="">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>CNPJ</label>
                                                    <input disabled id="newCnpj" class="form-control" type="text" name="cnpj" placeholder="00.000.000/0000-00" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>Porte da Empresa</label>
                                                    <select id="newCompanySize" class="form-control">
                                                        <option value="">Selecione</option>
                                                        <option value="Pequena">Pequena</option>
                                                        <option value="Média">Média</option>
                                                        <option value="Grande">Grande</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>Segmento de Atuação</label>
                                                    <input id="newBusinessSector" class="form-control" type="text" name="businessSector" placeholder="Ex: Tecnologia, Varejo, Serviços" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>Endereço</label>
                                                    <input id="newAddress" class="form-control" type="text" name="address" placeholder="Endereço completo" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col mb-3">
                                                <div class="form-group">
                                                    <label>Dados de Contato</label> 
                                                    <div class="row">
                                                        <div class="col">
                                                            <div class="form-group">
                                                                <label>Telefone</label>
                                                                <input id="newPhone" class="form-control" type="text" name="phone" placeholder="(XX) 9XXXX-XXXX" value="">
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            <div class="form-group">
                                                                <label>E-mail de Contato</label>
                                                                <input id="newEmail2" class="form-control" type="email" name="email" placeholder="contato@empresa.com.br" value="">
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            <div class="form-group">
                                                                <label>Site</label>
                                                                <input id="newWebsite" class="form-control" type="text" name="website" placeholder="www.empresa.com.br" value="">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <h4>Informações do Sócio</h4>
                                        <div class="row">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>Nome Completo do Sócio</label>
                                                    <input id="newPartnerName" class="form-control" type="text" name="partnerName" placeholder="Nome Completo do Sócio" value="">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>CPF do Sócio</label>
                                                    <input id="newPartnerCpf" class="form-control" type="text" name="partnerCpf" placeholder="000.000.000-00" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label>Cargo do Sócio</label>
                                                    <input id="newPartnerJobTitle" class="form-control" type="text" name="partnerJobTitle" placeholder="Ex: Sócio-Administrador, Diretor" value="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col d-flex justify-content-end">
                                        <button id="saveProfileBtn2" class="btn btn-primary" type="button">Salvar Alterações</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                      <!-- fim do conteudo "configuraçoes adicionais" -->

                    </div>
                  </div>
                </div>
              </div>
        
              <div class="col-12 col-md-3 mb-3">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="px-xl-3">
                      <button id="unlog" class="btn btn-block btn-danger">
                        <i class="fa fa-sign-out"></i>
                        <span>Sair</span>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="px-xl-3">
                      <a href="../index.html" class="btn btn-block btn-secondary">
                        <i class="fa fa-sign-out"></i>
                        <span>Voltar para o menu</span>
                      </a>
                    </div>

                  </div>

                </div>
                <div class="card">
                  <div class="card-body">
                    <h6 class="card-title font-weight-bold">Suporte</h6>
                    <p class="card-text">Obtenha ajuda rápida e gratuita utlizando a nossa ia! WoIN AI.</p>
                    <button type="button" class="btn btn-primary">Contate-nos</button>
                    <!-- <button id="oi" onclick="oi()">AAAAAAA</button> -->
                  </div>
                </div>
              </div>
            </div>
        
          </div>
        </div>
        </div>


        <script src="assets/js/scriptperfilJ.js"></script>

        <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

        <script defer>


          const firebaseConfig = {
          apiKey: "AIzaSyA3gOHi9Q6aHQ5seN5S9bbNmQpPQFMGXFs",
          authDomain: "magnus-c4b38.firebaseapp.com",
          projectId: "magnus-c4b38",
          storageBucket: "magnus-c4b38.appspot.com",
          messagingSenderId: "458576341456",
          appId: "1:458576341456:web:6117f4a9160b8667b8f1d5"
          };


          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          const db = firebase.firestore();

          // let btn = document.getElementById("btnTst")


          // btn.addEventListener("click", click)

          

          // function click() {
          //     const db = firebase.firestore();

          //     let profName = document.getElementById("profileName")
          //     // profName.textContent = "A"
          //     // console.log(profName)
          //     firebase.auth().onAuthStateChanged(user => {
          //     if (user) {
          //         var usuariosLista = db.collection('users').doc(user.uid);

          //         usuariosLista.get().then((doc) => {
          //         if (doc.exists) {
          //             const userData = doc.data()
          //             const nome = userData.username

          //             profName.textContent = nome

          //             console.log("Document data:", doc.data());
          //         } else {
          //             // doc.data() will be undefined in this case
          //             console.log("No such document!");
          //         }
          //     }).catch((error) => {
          //         console.log("Error getting document:", error);
          //     });

          //         db.collection('users').doc(user.uid).set({
          //             username: profName,
          //         })
          //     // Usuário está logado!
          //     console.log("Usuário logado:", user.uid);
          //     // Faça o que você precisa, por exemplo:
          //     // - Redirecione para a página home
          //     // - Exiba o nome do usuário
          //     // - Habilite conteúdo restrito
          //     } else {
          //     // Usuário não está logado
          //     console.log("Usuário não está logado.");
          //     // Faça o que você precisa, por exemplo:
          //     // - Redirecione para a página de login
          //     // - Desabilite conteúdo restrito
          //     }
          // });
          // }

          // let page = document.getElementById("corpo")


          // page.addEventListener("load", load)

          let unlog = document.getElementById("unlog")

          unlog.addEventListener("click", deslogar)


          function deslogar() {
               firebase.auth().signOut().then(() => {
                   // Sign-out successful.
                   console.log("Deslogado com sucesso!");
                   window.location.href = "../index.html";
                   }).catch((error) => {
                       // An error happened.
                       console.log("Erro ao deslogar:", error);
                       });
          }

          function load() {

              let unlog = document.getElementById("deslogar")
              let profName = document.getElementById("profileName")
              let profUser = document.getElementById("profileUser")

              let profNamePlaceholder = document.getElementById("newName")
              let profUserPlaceholder = document.getElementById("newUser")
              let profEmailPlaceholder = document.getElementById("newEmail")
              let profDescriptionPlaceholder = document.getElementById("newDescription")
              let quandoEntrou = document.getElementById("quandoEntrou")
              let deslogar = document.getElementById("deslogar")

              let profName2 = document.getElementById("newName2")
              let profCnpjPlaceholder = document.getElementById("newCnpj")
              let profCompanySizePlaceholder = document.getElementById("newCompanySize")
              let profSectorPlaceholder = document.getElementById("newBusinessSector")
              let profAddressPlaceholder = document.getElementById("newAddress")
              let profPhonePlaceholder = document.getElementById("newPhone")
              let profEmail2Placeholder = document.getElementById("newEmail2")
              let profSitePlaceholder = document.getElementById("newWebsite")
              let profPartnerNamePlaceholder = document.getElementById("newPartnerName")
              let profPartnerCpfPlaceholder = document.getElementById("newPartnerCpf")
              let profPartnerJobPlaceholder = document.getElementById("newPartnerJobTitle")

              // profName.textContent = "A"
              // console.log(profName)


              firebase.auth().onAuthStateChanged(user => {
              if (user) {

                const userId = user.uid
                const storageChild = firebase.storage().ref("user_photos/"+userId);
                const storageChildBanner = firebase.storage().ref("user_banner/"+userId);

                storageChild.list()
                .then(result => {
                  if (result.prefixes.length === 0 && result.items.length === 0) {
                    console.log("A pasta está vazia!");

                    var imagemPerfil = document.getElementById("profilePic")


                        
                    // var storageRef = firebase.storage().ref("user_photos/"+userId+"/"+fileName);


                
                
                    

                  } else {
                    console.log("A pasta contém arquivos!");

                    var imagemPerfil = document.getElementById("profilePic")

                    imagemPerfil.style.display = "inline"


                    var imagemPerfil = document.getElementById("profilePic")

                    if (result.items.length > 0) {
                    // Exclui o primeiro arquivo encontrado
                    const itemRef = result.items[0];

                    itemRef.getDownloadURL()
                    .then((url)=>{
                      imagemPerfil.style.backgroundImage = `url(${url})`
                    })
                    
                    

                    }
                    

                    
                  }
                })

                storageChildBanner.list()
                .then(result => {
                  if (result.prefixes.length === 0 && result.items.length === 0) {
                    console.log("A pasta está vazia!");

                    var userBanner = document.getElementById("userBanner")


                        
                    // var storageRef = firebase.storage().ref("user_photos/"+userId+"/"+fileName);


                
                
                    

                  } else {
                    console.log("A pasta contém arquivos!");

                    var userBanner = document.getElementById("userBanner")

                    userBanner.style.display = "inline"


                    var userBanner = document.getElementById("userBanner")

                    if (result.items.length > 0) {
                    // Exclui o primeiro arquivo encontrado
                    const itemRef = result.items[0];

                    itemRef.getDownloadURL()
                    .then((url)=>{
                      userBanner.style.backgroundImage = `url(${url})`
                    })
                    
                    

                    }
                    

                    
                  }
                })



                  
                  var usuariosLista = db.collection('users').doc(user.uid);

                  usuariosLista.get().then((doc) => {
                  if (doc.exists) {
                      const userData = doc.data()
                      const nome = userData.username
                      const user = userData.user
                      // const city = userData.city
                      const description = userData.description
                      const email = userData.emailContato
                      const cnpj = userData.cnpj
                      const tamanho = userData.tamanhoEmpresa
                      const setor = userData.setor
                      const endereco = userData.endereco
                      const telefone = userData.telefone
                      const emailSecundarioContato = userData.emailSecundarioContato
                      const site = userData.site
                      const nomeParceiro = userData.nomeParceiro
                      const cpfParceiro = userData.cpfParceiro
                      const cargoParceiro = userData.cargoParceiro

                      const dia = userData.dia
                      const mes = userData.mes
                      const ano = userData.ano

                      profName.textContent = nome
                      profUser.textContent = "@" + user
                      newName.value = nome
                      newUser.value = user

                      profEmailPlaceholder.value = email
                      profDescriptionPlaceholder.value = description


                      profName2.value = nome
                      profCnpjPlaceholder.value = cnpj
                      profCompanySizePlaceholder.value = tamanho
                      profSectorPlaceholder.value = setor
                      profAddressPlaceholder.value = endereco
                      profPhonePlaceholder.value = telefone
                      profEmail2Placeholder.value = emailSecundarioContato
                      profSitePlaceholder.value = site
                      profPartnerNamePlaceholder.value = nomeParceiro
                      profPartnerCpfPlaceholder.value = cpfParceiro
                      profPartnerJobPlaceholder.value = cargoParceiro



                      quandoEntrou.textContent = "Entrou em " + dia + " de " + mes + " de " + ano
                      

                      // profCity.textContent = city

                      // profEmail.textContent = email

                      console.log("Document data:", doc.data());
                  } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                  }
              }).catch((error) => {
                  console.log("Error getting document:", error);
              });

                  db.collection('users').doc(user.uid).set({
                      username: profName,
                  })
              // Usuário está logado!
              console.log("Usuário logado:", user.uid);
              // Faça o que você precisa, por exemplo:
              // - Redirecione para a página home
              // - Exiba o nome do usuário
              // - Habilite conteúdo restrito
              } else {
                  let login = document.getElementById("login")

                  login.style.display = "inline"
              // Usuário não está logado
              console.log("Usuário não está logado.");
              // Faça o que você precisa, por exemplo:
              // - Redirecione para a página de login
              // - Desabilite conteúdo restrito
              }
          });
          }


          

              

      </script>

</body>
</html>
